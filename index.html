<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CONDUCTOR</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#07070f;--surface:#10101e;--border:#252538;
  --gold:#c8a044;--text:#b0a898;--dim:#4a4560;
  --chaos:#ff3a50;--entropy:#44ffaa;
  --green:#44dd88;--red:#ff4455;
}
body{background:var(--bg);color:var(--text);font-family:Georgia,serif;
     height:100vh;display:flex;flex-direction:column;overflow:hidden;user-select:none}

/* â”€â”€ TOPBAR â”€â”€ */
#topbar{display:flex;align-items:center;justify-content:space-between;
        padding:7px 16px;border-bottom:1px solid var(--border);
        background:var(--surface);flex-shrink:0;gap:10px;flex-wrap:wrap}
.title{font-size:1em;letter-spacing:.4em;color:var(--gold);text-transform:uppercase}
.stats{display:flex;gap:14px;font-size:.8em;align-items:center;flex-wrap:wrap}
.stat{display:flex;align-items:center;gap:4px}
.sicon{color:var(--gold)}.sval{color:#fff;font-weight:bold}
.threat{font-size:.75em;padding:2px 8px;border-radius:3px;
        background:rgba(255,58,80,.1);border:1px solid rgba(255,58,80,.25);color:#ff8090}
.threat.hidden{display:none}
.boss-warn{font-size:.72em;padding:2px 8px;border-radius:3px;
           background:rgba(200,160,68,.12);border:1px solid rgba(200,160,68,.4);
           color:var(--gold);display:none}
.polmeter{display:flex;align-items:center;gap:5px;font-size:.75em}
.poltrack{width:52px;height:4px;background:var(--border);border-radius:3px;overflow:hidden}
.polfill{height:100%;border-radius:3px;transition:width .4s,background .4s}
.pollabel{color:var(--dim);min-width:26px;font-size:.9em}
.polbonus{color:var(--gold);font-size:.85em}
.pill{padding:2px 9px;border-radius:20px;font-size:.65em;
      letter-spacing:.12em;text-transform:uppercase;font-weight:bold}
.pill-shop  {background:rgba(200,160,68,.12);color:var(--gold);border:1px solid rgba(200,160,68,.4)}
.pill-combat{background:rgba(255,58,80,.12);color:var(--chaos);border:1px solid rgba(255,58,80,.4)}
.pill-result{background:rgba(68,255,170,.1);color:var(--entropy);border:1px solid rgba(68,255,170,.3)}

/* â”€â”€ MAIN â”€â”€ */
#main{flex:1;display:flex;flex-direction:column;padding:9px 13px;gap:5px;overflow:hidden}
.blabel{font-size:.63em;letter-spacing:.2em;color:var(--dim);
        text-transform:uppercase;margin-bottom:3px}
.board{display:flex;gap:7px;align-items:flex-end;min-height:114px;flex-wrap:wrap}
.slot{width:82px;height:108px;border:1px dashed var(--border);border-radius:6px;
      display:flex;align-items:center;justify-content:center;
      color:var(--dim);font-size:.65em}

/* â”€â”€ UNIT CARDS â”€â”€ */
.ucard{width:82px;min-height:108px;background:var(--surface);
       border:1px solid var(--border);border-radius:6px;
       display:flex;flex-direction:column;align-items:center;
       padding:6px 4px 5px;position:relative;overflow:hidden;
       transition:border-color .15s,transform .12s}
.ucard.attacking{border-color:var(--chaos);transform:scale(1.07);z-index:2}
.ucard.targeted {border-color:var(--red)}
.ucard.dead     {opacity:.2;filter:grayscale(1)}
.ucard.selectable{border-color:var(--gold);
                   box-shadow:0 0 9px rgba(200,160,68,.45);cursor:pointer}
.ucard.selectable:hover{box-shadow:0 0 16px rgba(200,160,68,.65)}
.ucard.lv2{border-color:rgba(200,160,68,.5)}
@keyframes flashRed{0%{background:rgba(255,60,80,.45)}100%{background:transparent}}
.ucard.flash{animation:flashRed .5s ease-out}
.usym{font-size:1.7em;line-height:1;margin-bottom:2px}
.uname{font-size:.56em;letter-spacing:.02em;color:var(--dim);
       text-align:center;margin-bottom:2px}
.ustats{display:flex;gap:5px;font-size:.74em}
.uatk{color:var(--chaos)}.uhp{color:var(--green)}.uhp.dmg{color:#ffcc44}
.ulv{font-size:.48em;color:var(--gold);letter-spacing:.06em;margin-top:1px}
.xpdots{font-size:.44em;color:var(--gold);margin-top:1px}
.ukw{font-size:.5em;font-weight:bold;padding:1px 4px;border-radius:3px;
     margin-top:2px;letter-spacing:.03em}
.kw-taunt    {background:rgba(58,111,255,.18);color:#6699ff;border:1px solid rgba(58,111,255,.3)}
.kw-haste    {background:rgba(255,200,68,.13);color:var(--gold);border:1px solid rgba(255,200,68,.28)}
.kw-retaliate{background:rgba(255,58,80,.13);color:#ff8090;border:1px solid rgba(255,58,80,.28)}
.kw-leech    {background:rgba(68,255,170,.1);color:var(--entropy);border:1px solid rgba(68,255,170,.22)}
.polbar{position:absolute;bottom:0;left:0;right:0;height:3px}
.hpbar{position:absolute;bottom:3px;left:4px;right:4px;height:2px;
       background:#181828;border-radius:1px}
.hpfill{height:100%;border-radius:1px;transition:width .3s}
.entbadge{position:absolute;top:2px;right:2px;background:var(--entropy);
          color:#020f06;font-size:.52em;font-weight:bold;width:12px;height:12px;
          border-radius:50%;display:flex;align-items:center;justify-content:center}
.orderbadge{position:absolute;top:2px;left:2px;background:var(--surface);
            border:1px solid var(--border);color:var(--dim);font-size:.48em;
            font-weight:bold;width:12px;height:12px;border-radius:50%;
            display:flex;align-items:center;justify-content:center}
.sellbtn{position:absolute;bottom:17px;left:2px;font-size:.48em;color:var(--chaos);
         border:1px solid var(--chaos);border-radius:2px;padding:1px 3px;
         cursor:pointer;background:var(--bg);opacity:0;transition:opacity .2s;z-index:2}
.ucard:hover .sellbtn{opacity:1}

/* â”€â”€ LOG BAR â”€â”€ */
#logbar{background:var(--surface);border:1px solid var(--border);
        border-radius:4px;overflow:hidden;flex-shrink:0;display:none}
#loginner{display:flex;align-items:center;gap:9px;padding:6px 11px;font-size:.77em}
.logtext{flex:1}
.logtag{color:var(--dim);font-size:.8em;letter-spacing:.1em;
        text-transform:uppercase;white-space:nowrap}
#timertrack{height:2px;background:var(--border)}
#timerfill{height:100%;background:var(--gold);width:0%;transition:none}

/* â”€â”€ BOTTOM â”€â”€ */
#bottom{flex-shrink:0;padding-top:5px;border-top:1px solid var(--border)}
#shop{display:flex;gap:7px;align-items:flex-start;flex-wrap:wrap}
.sunit{width:82px;background:var(--surface);border:1px solid var(--border);
       border-radius:6px;padding:6px 4px 5px;cursor:pointer;text-align:center;
       transition:border-color .15s}
.sunit:hover:not(.unafford){border-color:var(--gold)}
.sunit.unafford{opacity:.42;cursor:not-allowed}
.scost{font-size:.68em;color:var(--gold);margin-top:2px}
.shoppolrow{display:flex;align-items:center;gap:3px;margin-top:2px}
.shoppolbar{flex:1;height:3px;border-radius:2px}
.shoppollabel{font-size:.48em;color:var(--dim)}
.shop-actions{display:flex;flex-direction:column;gap:5px;
              margin-left:auto;align-items:flex-end;min-width:90px}
.bonus-note{font-size:.63em;color:var(--gold)}
.tier-note{font-size:.6em;color:var(--dim)}
.btn{padding:5px 12px;border:1px solid var(--border);background:var(--surface);
     color:var(--text);font-family:Georgia,serif;font-size:.76em;cursor:pointer;
     letter-spacing:.04em;transition:border-color .15s,color .15s;border-radius:3px}
.btn:hover{border-color:var(--gold);color:var(--gold)}
.btn.primary{border-color:rgba(200,160,68,.5);color:var(--gold)}
.btn.primary:hover{background:rgba(200,160,68,.08)}
.btn:disabled{opacity:.35;cursor:not-allowed;pointer-events:none}

/* â”€â”€ CONDUCTOR â”€â”€ */
#conductor{display:flex;gap:7px;align-items:flex-start}
.clabel{display:flex;flex-direction:column;gap:3px;
        justify-content:center;min-width:86px}
.clabel-title{font-size:.63em;letter-spacing:.14em;color:var(--dim);text-transform:uppercase}
.clabel-note{font-size:.6em;color:var(--dim);line-height:1.4}
.clabel-note.active{color:var(--gold)}
.clabel-note.window{color:var(--entropy)}
.ccard{width:92px;background:var(--surface);border:1px solid #2a2a44;
       border-radius:6px;padding:6px;cursor:pointer;
       transition:border-color .15s,box-shadow .15s;text-align:center}
.ccard:hover:not(.cused){border-color:var(--gold)}
.ccard.csel{border-color:var(--gold);box-shadow:0 0 10px rgba(200,160,68,.35)}
.ccard.cused{opacity:.4;cursor:not-allowed}
.ccard.cwindow:not(.cused){border-color:rgba(68,255,170,.5);
                            box-shadow:0 0 8px rgba(68,255,170,.2)}
.csym{font-size:1.25em;display:block;margin-bottom:2px;color:var(--gold)}
.cname{font-size:.63em;color:#fff;font-weight:bold;display:block;margin-bottom:2px}
.cdesc{font-size:.53em;color:var(--dim);line-height:1.3}

/* â”€â”€ OVERLAYS â”€â”€ */
#overlay,#tutorial,#levelup{
  position:fixed;inset:0;background:rgba(7,7,15,.9);
  display:none;flex-direction:column;align-items:center;
  justify-content:center;gap:14px;z-index:100}
.rtitle{font-size:1.8em;letter-spacing:.3em;text-transform:uppercase}
.rtitle.win {color:var(--gold)}
.rtitle.loss{color:var(--chaos)}
.rtitle.draw{color:var(--dim)}
.rsub{font-size:.8em;color:var(--dim);text-align:center;
      max-width:300px;line-height:1.7}

/* â”€â”€ TUTORIAL â”€â”€ */
.tbox{background:var(--surface);border:1px solid var(--border);
      border-radius:8px;padding:26px 30px;max-width:400px;
      display:flex;flex-direction:column;gap:13px}
.tstep{font-size:.6em;letter-spacing:.22em;text-transform:uppercase;color:var(--dim)}
.ttitle{font-size:1.2em;color:var(--gold);letter-spacing:.07em}
.tbody{font-size:.8em;color:var(--text);line-height:1.75}
.tbody strong{color:#fff}
.kw-inline{font-size:.85em;font-weight:bold;padding:1px 5px;border-radius:3px}
.tfoot{display:flex;justify-content:space-between;align-items:center;margin-top:4px}
.tdots{display:flex;gap:5px}
.tdot{width:6px;height:6px;border-radius:50%;background:var(--border)}
.tdot.active{background:var(--gold)}

/* â”€â”€ LEVEL-UP â”€â”€ */
.lubox{background:var(--surface);border:1px solid var(--gold);
       border-radius:8px;padding:26px 30px;max-width:340px;
       display:flex;flex-direction:column;align-items:center;gap:14px}
.lutitle{font-size:1em;letter-spacing:.3em;text-transform:uppercase;color:var(--gold)}
.lusub{font-size:.78em;color:var(--dim);text-align:center}
.luchoices{display:flex;gap:12px}
.luchoice{width:110px;background:var(--bg);border:1px solid var(--border);
          border-radius:6px;padding:12px 8px;cursor:pointer;text-align:center;
          transition:border-color .15s}
.luchoice:hover{border-color:var(--gold)}
.luchoice-icon{font-size:1.6em;margin-bottom:5px}
.luchoice-label{font-size:.7em;color:var(--gold);font-weight:bold}
.luchoice-desc{font-size:.6em;color:var(--dim);margin-top:2px}

/* â”€â”€ SCOUT REVEAL â”€â”€ */
.scout-reveal{display:flex;align-items:center;gap:8px;
              font-size:.72em;color:var(--dim);margin-top:4px}
.scout-reveal strong{color:var(--gold)}
</style>
</head>
<body>

<!-- TOPBAR -->
<div id="topbar">
  <div class="title">Conductor</div>
  <div class="stats">
    <div class="stat"><span class="sicon">â™¥</span><span class="sval" id="shp">30</span></div>
    <div class="stat"><span class="sicon">â—ˆ</span><span class="sval" id="srd">Round 1</span></div>
    <div class="stat" id="sgwrap">
      <span class="sicon">ðŸª™</span><span class="sval" id="sgold">3</span>
    </div>
    <div class="threat hidden" id="threat">
      âš” If you lose: <span id="threatval">0</span> dmg
    </div>
    <div class="boss-warn" id="bosswarn"></div>
    <div class="polmeter" id="polmeter" style="display:none">
      <span style="font-size:.7em;color:var(--dim)">Board:</span>
      <div class="poltrack"><div class="polfill" id="polfill"></div></div>
      <span class="pollabel" id="pollabel">â€”</span>
      <span class="polbonus" id="polbonus"></span>
    </div>
  </div>
  <div class="pill pill-shop" id="sphase">Shop</div>
</div>

<!-- MAIN -->
<div id="main">
  <div>
    <div class="blabel">Opponent</div>
    <div class="board" id="eboard"></div>
  </div>
  <div id="logbar">
    <div id="timertrack"><div id="timerfill"></div></div>
    <div id="loginner">
      <span class="logtext" id="ltext">â€”</span>
      <span class="logtag"  id="ltag"></span>
    </div>
  </div>
  <div>
    <div class="blabel">Your Board</div>
    <div class="board" id="pboard"></div>
  </div>
  <div id="bottom">
    <div id="shop"></div>
    <div id="conductor" style="display:none"></div>
  </div>
</div>

<!-- RESULT OVERLAY -->
<div id="overlay">
  <div class="rtitle" id="rtitle"></div>
  <div class="rsub"   id="rsub"></div>
  <button class="btn primary" id="rbtn">Continue</button>
</div>

<!-- LEVEL-UP OVERLAY -->
<div id="levelup">
  <div class="lubox">
    <div class="lutitle">â¬¡ Unit Levelled Up</div>
    <div class="lusub" id="luname"></div>
    <div class="luchoices">
      <div class="luchoice" id="lu-atk">
        <div class="luchoice-icon">âš”</div>
        <div class="luchoice-label">+1 ATK</div>
        <div class="luchoice-desc">Strike harder</div>
      </div>
      <div class="luchoice" id="lu-hp">
        <div class="luchoice-icon">â™¥</div>
        <div class="luchoice-label">+1 HP</div>
        <div class="luchoice-desc">Endure longer</div>
      </div>
    </div>
  </div>
</div>

<!-- TUTORIAL OVERLAY -->
<div id="tutorial">
  <div class="tbox">
    <div class="tstep"  id="tstep"></div>
    <div class="ttitle" id="ttitle"></div>
    <div class="tbody"  id="tbody"></div>
    <div class="tfoot">
      <div class="tdots" id="tdots"></div>
      <button class="btn primary" id="tnext">Next â†’</button>
    </div>
  </div>
</div>

<!-- BOOTSTRAP -->
<script type="module">
  import { initStarterBoard }   from './state.js';
  import { startRound }         from './shop.js';
  import { initTutorial }       from './tutorial.js';
  import { render, initEvents } from './render.js';
  import { onContinue,
           applyLevelUp }       from './flow.js';

  // Boot sequence
  initStarterBoard();
  startRound();
  initTutorial();
  initEvents({ onContinue, applyLevelUp });

  // Boss warning: render.js exposes a hook for topbar extras
  // that sit outside its normal render cycle.
  import { G } from './state.js';
  function renderBossWarn() {
    const el = document.getElementById('bosswarn');
    if (G.upcomingBoss) {
      el.textContent  = `âš  ${G.upcomingBoss}`;
      el.style.display = 'block';
    } else {
      el.style.display = 'none';
    }
  }

  // Patch render to also update the boss warning each cycle.
  // Lightweight observer pattern â€” avoids touching render.js internals.
  const { render: _render } = await import('./render.js');
  const origRender = _render;
  // Re-export is live-binding so we instead hook via a MutationObserver
  // on #sphase (changes every render) to trigger the boss warn update.
  new MutationObserver(renderBossWarn)
    .observe(document.getElementById('sphase'), { childList: true });
</script>
</body>
</html>